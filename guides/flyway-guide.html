<!DOCTYPE html>
<html>

<head>
  <title>Flyway Guide</title>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="https://quarkus.io//feed.xml" title="Quarkus">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NJWS5L');</script>
  <!-- End Google Tag Manager -->
  <!-- Syntax highlighting -->
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/get-started/" class="">Get Started</a>
            </li>
            <li>
              <a href="/guides/" class="active">Guides</a>
            </li>
            <li>
              <a href="/extensions/" class="">Extensions</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="">Blog</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="guides">
  <div class="width-12-12">
    <h1 class="text-caps">Flyway Guide</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://flywaydb.org/">Flyway</a> is a popular database migration tool that is commonly used in JVM environments.</p>
</div>
<div class="paragraph">
<p>Quarkus provides first class support for using Flyway as will be explained in this guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-support-for-flyway">Setting up support for Flyway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To start using Flyway with your project, you just need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add your migrations to the <code>src/main/resources/db/migration</code> folder as you usually do with Flyway</p>
</li>
<li>
<p>activate the <code>migrate-at-start</code> option to migrate the schema automatically or inject the <code>Flyway</code> object and run
your migration as you normally do</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In your <code>pom.xml</code>, add the following dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the Flyway extension</p>
</li>
<li>
<p>your JDBC driver extension (<code>quarkus-jdbc-postgresql</code>, <code>quarkus-jdbc-h2</code>, <code>quarkus-jdbc-mariadb</code>, &#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;
    &lt;!-- Flyway specific dependencies --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
        &lt;artifactId&gt;quarkus-flyway&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- JDBC driver dependencies --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
        &lt;artifactId&gt;quarkus-jdbc-postgresql&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Flyway support relies on the Quarkus default datasource config, you must add the default datasource properties
to the <code>application.properties</code> file in order to allow Flyway to manage the schema.
Also, you can customize the Flyway behaviour by using the following properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.flyway.migrate-at-start</code></dt>
<dd>
<p><strong>true</strong> to execute Flyway automatically when the application starts, <strong>false</strong> otherwise.<br>
<strong>default:</strong> false</p>
</dd>
<dt class="hdlist1"><code>quarkus.flyway.locations</code></dt>
<dd>
<p>Comma-separated list of locations to scan recursively for migrations. The location type is determined by its prefix.
Unprefixed locations or locations starting with classpath: point to a package on the classpath and may contain both SQL
and Java-based migrations.
Locations starting with filesystem: point to a directory on the filesystem, may only contain SQL migrations and are only
scanned recursively down non-hidden directories.<br>
<strong>default:</strong> classpath:db/migration</p>
</dd>
<dt class="hdlist1"><code>quarkus.flyway.connect-retries</code></dt>
<dd>
<p>The maximum number of retries when attempting to connect to the database. After each failed attempt, Flyway will wait 1
second before attempting to connect again, up to the maximum number of times specified by connect-retries.<br>
<strong>default:</strong> 0</p>
</dd>
<dt class="hdlist1"><code>quarkus.flyway.schemas</code></dt>
<dd>
<p>Comma-separated case-sensitive list of schemas managed by Flyway.
The first schema in the list will be automatically set as the default one during the migration.
It will also be the one containing the schema history table.<br>
<strong>default:</strong> &lt;none&gt;</p>
</dd>
<dt class="hdlist1"><code>quarkus.flyway.table</code></dt>
<dd>
<p>The name of Flyway&#8217;s schema history table.
By default (single-schema mode) the schema history table is placed in the default schema for the connection provided by
the datasource.
When the quarkus.flyway.schemas property is set (multi-schema mode), the schema history table is placed in the first schema of
the list.<br>
<strong>default:</strong> flyway_schema_history</p>
</dd>
<dt class="hdlist1"><code>quarkus.flyway.sql-migration-prefix</code></dt>
<dd>
<p>The file name prefix for versioned SQL migrations.
Versioned SQL migrations have the following file name structure: prefixVERSIONseparatorDESCRIPTIONsuffix , which using
the defaults translates to V1.1__My_description.sql<br>
<strong>default:</strong> V</p>
</dd>
<dt class="hdlist1"><code>quarkus.flyway.repeatable-sql-migration-prefix</code></dt>
<dd>
<p>The file name prefix for repeatable SQL migrations.
Repeatable SQL migrations have the following file name structure: prefixSeparatorDESCRIPTIONsuffix , which using the
defaults translates to R__My_description.sql<br>
<strong>default:</strong> R</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following is an example for the <code>application.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs"># configure your datasource
quarkus.datasource.url: jdbc:postgresql://localhost:5432/mydatabase
quarkus.datasource.driver: org.postgresql.Driver
quarkus.datasource.username: sarah
quarkus.datasource.password: connor

# Flyway minimal config properties
quarkus.flyway.migrate-at-start=true

# Flyway optional config properties
# quarkus.flyway.connect-retries=10
# quarkus.flyway.schemas=TEST_SCHEMA
# quarkus.flyway.table=flyway_quarkus_history
# quarkus.flyway.locations=db/location1,db/location2
# quarkus.flyway.sql-migration-prefix=X
# quarkus.flyway.repeatable-sql-migration-prefix=K</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add a SQL migration to the default folder following the Flyway naming conventions: <code>src/main/resources/db/migration/V1.0.0__Quarkus.sql</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sql" class="language-sql hljs">CREATE TABLE quarkus
(
  id   INT,
  name VARCHAR(20)
);
INSERT INTO quarkus(id, name)
VALUES (1, 'QUARKED');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can start your application and Quarkus will run the Flyway&#8217;s migrate method according to your config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
public class MigrationService {
    // You can Inject the object if you want to use it manually
    @Inject
    Flyway flyway; <b class="conum">(1)</b>

    public void checkMigration() {
        // This will print 1.0.0
        System.out.println(flyway.info().current().getVersion().toString());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Inject the Flyway object if you want to use it directly</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-flyway-object">Using the Flyway object</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In case you are interested in using the <code>Flyway</code> object directly, you can inject it as follows:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you enabled the <code>quarkus.flyway.migrate-at-start</code> property, by the time you use the Flyway instance,
Quarkus will already have run the migrate operation
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
public class MigrationService {
    // You can Inject the object if you want to use it manually
    @Inject
    Flyway flyway; <b class="conum">(1)</b>

    public void checkMigration() {
        // Use the flyway instance manually
        flyway.clean(); <b class="conum">(2)</b>
        flyway.migrate();
        // This will print 1.0.0
        System.out.println(flyway.info().current().getVersion().toString());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Inject the Flyway object if you want to use it directly</p>
</li>
<li>
<p>Use the Flyway instance directly</p>
</li>
</ol>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. Quarkus and its extensions are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what youâ€™ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Google&nbsp;Groups</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>Quarkus is proudly made of</span>
        <ul class="footer-links">
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
