<!DOCTYPE html>
<html>

<head>
  <title>Metrics Guide</title>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="https://quarkus.io//feed.xml" title="Quarkus">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NJWS5L');</script>
  <!-- End Google Tag Manager -->
  <!-- Syntax highlighting -->
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/get-started/" class="">Get Started</a>
            </li>
            <li>
              <a href="/guides/" class="active">Guides</a>
            </li>
            <li>
              <a href="/extensions/" class="">Extensions</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="">Blog</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="guides">
  <div class="width-12-12">
    <h1 class="text-caps">Metrics Guide</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide demonstrates how your Quarkus application can utilize the MicroProfile
Metrics specification through the SmallRye Metrics extension.</p>
</div>
<div class="paragraph">
<p>MicroProfile Metrics allows applications to gather various metrics and statistics that provide
insights into what is happening inside the application.</p>
</div>
<div class="paragraph">
<p>The metrics can be read remotely using JSON format or the OpenMetrics format, so that
they can be processed by additional tools such as Prometheus, and stored for analysis
and visualisation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>less than 15 minutes</p>
</li>
<li>
<p>an IDE</p>
</li>
<li>
<p>JDK 1.8+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.5.3+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture">Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this example, we build a very simple microservice which offers one REST endpoint and that endpoint serves
for determining whether a number is prime. The implementation class is annotated with some metric annotations
so that while responding to user&#8217;s requests, some metrics are gathered. The meaning of each metric will be explained later.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution">Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step.
However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code>, or download an <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/master.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>microprofile-metrics</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/master/microprofile-metrics">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project">Creating the Maven Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we need a new project. Create a new project with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">mvn io.quarkus:quarkus-maven-plugin:0.16.0:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=microprofile-metrics \
    -Dextensions="smallrye-metrics, resteasy"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command generates a Maven project, importing the <code>smallrye-metrics</code> extension
which is an implementation of the MicroProfile Metrics specification used in Quarkus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-application">Writing the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The application consists of a single class that implements an algorithm for checking whether a number is prime.
This algorithm is exposed over a REST interface. Additionally, we need a few annotations to make sure
that our desired metrics are calculated over time and can be exported for manual analysis or processing by additional tooling.</p>
</div>
<div class="paragraph">
<p>The metrics that we will gather are these:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>performedChecks</code>: A counter which is increased by one each time the user asks about a number.</p>
</li>
<li>
<p><code>highestPrimeNumberSoFar</code>:  This is a gauge that stores the highest number that was asked about by the user and which was determined to be prime.</p>
</li>
<li>
<p><code>checksTimer</code>: This is a timer, therefore a compound metric that benchmarks how much time the primality tests take. We will explain that one in more details later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The full source code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package org.acme.metrics;

import org.eclipse.microprofile.metrics.MetricUnits;
import org.eclipse.microprofile.metrics.annotation.Counted;
import org.eclipse.microprofile.metrics.annotation.Gauge;
import org.eclipse.microprofile.metrics.annotation.Timed;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;

@Path("/")
public class PrimeNumberChecker {

    private long highestPrimeNumberSoFar = 2;

    @GET
    @Path("/{number}")
    @Produces("text/plain")
    @Counted(name = "performedChecks", monotonic = true, description = "How many primality checks have been performed.")
    @Timed(name = "checksTimer", description = "A measure of how long it takes to perform the primality test.", unit = MetricUnits.MILLISECONDS)
    public String checkIfPrime(@PathParam("number") long number) {
        if (number &lt; 1) {
            return "Only natural numbers can be prime numbers.";
        }
        if (number == 1) {
            return "1 is not prime.";
        }
        if (number == 2) {
                    return "2 is prime.";
        }
        if (number % 2 == 0) {
            return number + " is not prime, it is divisible by 2.";
        }
        for (int i = 3; i &lt; Math.floor(Math.sqrt(number)) + 1; i = i + 2) {
            if (number % i == 0) {
                return number + " is not prime, is divisible by " + i + ".";
            }
        }
        if (number &gt; highestPrimeNumberSoFar) {
            highestPrimeNumberSoFar = number;
        }
        return number + " is prime.";
    }

    @Gauge(name = "highestPrimeNumberSoFar", unit = MetricUnits.NONE, description = "Highest prime number so far.")
    public Long highestPrimeNumberSoFar() {
        return highestPrimeNumberSoFar;
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-and-using-the-application">Running and using the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the microservice in dev mode, use <code>./mvnw clean compile quarkus:dev</code></p>
</div>
<div class="sect2">
<h3 id="generate-some-values-for-the-metrics">Generate some values for the metrics</h3>
<div class="paragraph">
<p>First, ask the endpoint whether some numbers are prime numbers.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl localhost:8080/350</pre>
</div>
</div>
<div class="paragraph">
<p>The application will respond that 350 is not a prime number because it can be divided by 2.</p>
</div>
<div class="paragraph">
<p>Now for some large prime number so that the test takes a bit more time:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl localhost:8080/629521085409773</pre>
</div>
</div>
<div class="paragraph">
<p>The application will respond that 629521085409773 is a prime number.
If you want, try some more calls with numbers of your choice.</p>
</div>
</div>
<div class="sect2">
<h3 id="review-the-generated-metrics">Review the generated metrics</h3>
<div class="paragraph">
<p>To view the metrics, execute <code>curl -H"Accept: application/json" localhost:8080/metrics/application</code>
You will receive a response such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "org.acme.metrics.PrimeNumberChecker.checksTimer" : {
    "p50": 217.231273,
    "p75": 217.231273,
    "p95": 217.231273,
    "p98": 217.231273,
    "p99": 217.231273,
    "p999": 217.231273,
    "min": 0.58961,
    "mean": 112.15909190834819,
    "max": 217.231273,
    "stddev": 108.2721053982776,
    "count": 2,
    "meanRate": 0.04943519091742238,
    "oneMinRate": 0.2232140583080189,
    "fiveMinRate": 0.3559527083952095,
    "fifteenMinRate": 0.38474303050928976
  },
  "org.acme.metrics.PrimeNumberChecker.performedChecks" : 2,
  "org.acme.metrics.PrimeNumberChecker.highestPrimeNumberSoFar" : 629521085409773
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s explain the meaning of each metric:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>performedChecks</code>: A counter which is increased by one each time the user asks about a number.</p>
</li>
<li>
<p><code>highestPrimeNumberSoFar</code>: This is a gauge that stores the highest number that was asked about by the user and which was determined to be prime.</p>
</li>
<li>
<p><code>checksTimer</code>: This is a timer, therefore a compound metric that benchmarks how much time the primality tests take. All durations are measured in milliseconds. It consists of these values:</p>
<div class="ulist">
<ul>
<li>
<p><code>min</code>: The shortest duration it took to perform a primality test, probably it was performed for a small number.</p>
</li>
<li>
<p><code>max</code>: The longest duration, probably it was with a large prime number.</p>
</li>
<li>
<p><code>mean</code>: The mean value of the measured durations.</p>
</li>
<li>
<p><code>stddev</code>: The standard deviation.</p>
</li>
<li>
<p><code>count</code>: The number of observations (so it will be the same value as <code>performedChecks</code>).</p>
</li>
<li>
<p><code>p50, p75, p95, p99, p999</code>: Percentiles of the durations. For example the value in <code>p95</code> means that 95 % of the measurements were faster than this duration.</p>
</li>
<li>
<p><code>meanRate, oneMinRate, fiveMinRate, fifteenMinRate</code>: Mean throughput and one-, five-, and fifteen-minute exponentially-weighted moving average throughput.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you prefer an OpenMetrics export rather than the JSON format, remove the <code>-H"Accept: application/json"</code> argument from your command line.</p>
</div>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. Quarkus and its extensions are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what youâ€™ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Google&nbsp;Groups</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>Quarkus is proudly made of</span>
        <ul class="footer-links">
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
