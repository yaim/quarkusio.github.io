<!DOCTYPE html>
<html>

<head>
  <title>Health Guide</title>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NJWS5L');</script>
  <!-- End Google Tag Manager -->
  <!-- Syntax highlighting -->
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/get-started/" class="">Get Started</a>
            </li>
            <li>
              <a href="/guides/" class="active">Guides</a>
            </li>
            <li>
              <a href="/extensions/" class="">Extensions</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="">Blog</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="guides">
  <div class="width-12-12">
    <h1 class="text-caps">Health Guide</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide demonstrates how your Quarkus application can utilize the MicroProfile
Health specification through the SmallRye Health extension.</p>
</div>
<div class="paragraph">
<p>MicroProfile Health allows applications to provide information about their state
to external viewers which is typically useful in cloud environments where automated
processes must be able to determine whether the application should be discarded
or restarted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>less than 15 minutes</p>
</li>
<li>
<p>an IDE</p>
</li>
<li>
<p>JDK 1.8+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.5.3+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture">Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we build a simple REST application that exposes MicroProfile Health functionalities at
the <code>/health</code> endpoint according to the specification. It will also provide several other REST
endpoints to allow us to dynamically change the healthness of our Quarkus application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution">Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step.
However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code>, or download an <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/master.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>microprofile-health</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/master/microprofile-health">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project">Creating the Maven Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we need a new project. Create a new project with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">mvn io.quarkus:quarkus-maven-plugin:0.15.0:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=microprofile-health \
    -Dextensions="smallrye-health"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command generates a Maven project, importing the <code>smallrye-health</code> extension
which is an implementation of the MicroProfile Health specification used in Quarkus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-health-check">Running the health check</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Importing the <code>smallrye-health</code> extension directly exposes a single REST endpoint at
the <code>/health</code> endpoint that can be used to run the health check procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>start your Quarkus application with <code>mvn compile quarkus:dev</code></p>
</li>
<li>
<p>access the <code><a href="http://localhost:8080/health" class="bare">http://localhost:8080/health</a></code> endpoint using your browser or
<code>curl <a href="http://localhost:8080/health" class="bare">http://localhost:8080/health</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The health REST enpoint returns a simple JSON object with two fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>outcome</code>&#8201;&#8212;&#8201;the overall result of all the health check procedures</p>
</li>
<li>
<p><code>checks</code>&#8201;&#8212;&#8201;an array of individual checks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The general <code>outcome</code> of the health check is computed as a logical AND of all the declared
health check procedures. The <code>checks</code> array is empty as we have not specified any health
check procedure yet so let&#8217;s define some.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-your-first-health-check">Creating your first health check</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we create our first simple health check procedure.</p>
</div>
<div class="paragraph">
<p>Create the <code>org.acme.health.SimpleHealthCheck</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package org.acme.health;

import org.eclipse.microprofile.health.Health;
import org.eclipse.microprofile.health.HealthCheck;
import org.eclipse.microprofile.health.HealthCheckResponse;

import javax.enterprise.context.ApplicationScoped;

@Health
@ApplicationScoped
public class SimpleHealthCheck implements HealthCheck {

    @Override
    public HealthCheckResponse call() {
        return HealthCheckResponse.named("Simple health check").up().build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see health check procedures are defined as implementations of the <code>HealthCheck</code>
interface which are defined as CDI beans with the <code>@Health</code> qualifier. <code>HealthCheck</code> is
a functional interface whose single method <code>call</code> returns a <code>HealthCheckResponse</code> object
which can be easily constructed by the fluent builder API shown in the example.</p>
</div>
<div class="paragraph">
<p>As we have started our Quarkus application in dev mode simply repeat the request
to <code><a href="http://localhost:8080/health" class="bare">http://localhost:8080/health</a></code> by refreshing your browser window or by using <code>curl <a href="http://localhost:8080/health" class="bare">http://localhost:8080/health</a></code>.
The new health check procedure is now present in the <code>checks</code> array.</p>
</div>
<div class="paragraph">
<p>Congratulations! You&#8217;ve created your first Quarkus health check procedure. Let&#8217;s
continue by exploring what else can be done with the MicroProfile Health specification.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-user-specific-data-to-the-health-check-response">Adding user specific data to the health check response</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In previous section we saw how to create a simple health check with only the minimal
attributes, namely, the health check name and its state (UP or DOWN). However, the
MicroProfile specification also provides a way for the applications to supply
arbitrary data in the form of key value pairs sent to the consuming end. This can be done by using the
<code>withData(key, value)</code> method of the health check response builder API.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create our second health check procedure <code>org.acme.health.DataHealthCheck</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package org.acme.health;

import org.eclipse.microprofile.health.Health;
import org.eclipse.microprofile.health.HealthCheck;
import org.eclipse.microprofile.health.HealthCheckResponse;

import javax.enterprise.context.ApplicationScoped;

@Health
@ApplicationScoped
public class DataHealthCheck implements HealthCheck {

    @Override
    public HealthCheckResponse call() {
        return HealthCheckResponse.named("Health check with data")
                .up()
                .withData("foo", "fooValue")
                .withData("bar", "barValue")
                .build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you rerun the health check procedure again by accessing the <code>/health</code> endpoint you can
see that the new health check <code>Health check with data</code> is present in the <code>checks</code> array.
This check contains a new attribute called <code>data</code> which is a JSON object consisting of
the properties we have defined in our health check procedure.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="negative-health-check-procedure">Negative health check procedure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we create another health check procedure which simulates a connection to
an external service provider such as a database. For simplicity reasons, we only determine
whether the database is accessible or not by a configuration property.</p>
</div>
<div class="paragraph">
<p>Create <code>org.acme.health.DatabaseConnectionHealthCheck</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package org.acme.health;

import org.eclipse.microprofile.config.inject.ConfigProperty;
import org.eclipse.microprofile.health.Health;
import org.eclipse.microprofile.health.HealthCheck;
import org.eclipse.microprofile.health.HealthCheckResponse;
import org.eclipse.microprofile.health.HealthCheckResponseBuilder;

import javax.enterprise.context.ApplicationScoped;
import javax.inject.Inject;

@Health
@ApplicationScoped
public class DatabaseConnectionHealthCheck implements HealthCheck {

    @ConfigProperty(name = "database.up", defaultValue = "false")
    private boolean databaseUp;

    @Override
    public HealthCheckResponse call() {

        HealthCheckResponseBuilder responseBuilder = HealthCheckResponse.named("Database connection health check");

        try {
            simulateDatabaseConnectionVerification();
            responseBuilder.up();
        } catch (IllegalStateException e) {
            // cannot access the database
            responseBuilder.down()
                    .withData("error", e.getMessage());
        }

        return responseBuilder.build();
    }

    private void simulateDatabaseConnectionVerification() {
        if (!databaseUp) {
            throw new IllegalStateException("Cannot contact database");
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you now rerun the health check the overall <code>outcome</code> should be DOWN and you should
see in the <code>checks</code> array the newly added <code>Database connection health check</code> which is
down and the error message explaining why it failed.</p>
</div>
<div class="paragraph">
<p>As we shouldn&#8217;t leave this application with a health check in DOWN state and because we
are running Quarkus dev mode you can add <code>database.up=true</code> in
<code>src/main/resources/application.properties</code> and rerun the health check again&#8201;&#8212;&#8201;it should be up again.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MicroProfile Health provides a way for your application to distribute information
about its healthness state to state whether or not it is able to function properly.</p>
</div>
<div class="paragraph">
<p>All that is needed to enable the MicroProfile Health features in Quarkus is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>adding the <code>smallrye-health</code> Quarkus extension to your project using the <code>quarkus-maven-plugin</code>:</p>
<div class="literalblock">
<div class="content">
<pre>mvn quarkus:add-extension -Dextensions="smallrye-health"</pre>
</div>
</div>
</li>
<li>
<p>or simply adding the following Maven dependency:</p>
<div class="literalblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-smallrye-health&lt;/artifactId&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. Quarkus and its extensions are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what youâ€™ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Google&nbsp;Groups</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>Quarkus is proudly made of</span>
        <ul class="footer-links">
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
